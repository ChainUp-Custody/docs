# MPC钱包 

欢迎来到**ChainUp Custody**，ChainUp Custody基于深厚的底层钱包技术和安全的区块链钱包架构，将强大的资产托管功通过接口的方式提供给第三方合作伙伴。通过这种方式能帮助合作伙伴在关注于核心业务发展的同时也能确保资产的安全。

您可以通过API提交传输，并接收传输的实时信息; 安全检查所有事务类型和消息;  管理你的钱包和子钱包账户、地址簿和网络连接;  并利用反洗钱机制等功能。所有转账都反映在ChainUp Custody的开放平台、交易记录、安全策略和对账中心中。



# 概述

## 介绍

ChainUp Custody对于MPC技术的整体实施应用能够保证您的投资资产处于市场上最高级别的安全等级的托管保护之下，用户的私钥将由用户和ChainUp Custody共同管理，该技术使您拥有资产完整控制权，您对资产的管理使用不受时间和地点的限制。方便资产的备份和恢复，消除私钥管理的单点故障问题，同时增加了资产自管的安全性。



目前ChainUp Custody服务客户已突破500家，涉及各行业，如：区块链行业：交易所、项目方、矿工、OTC、借贷等；传统行业：游戏、地产、直播、电商、供应链、媒体等；



## 愿景 

ChainUp Custody旨在通过搭建一套跨主链，跨项目方的全球金融清算体系，共享联盟成员流量，降低联盟成员成本，提升联盟成员资产使用率，构建区块链领域中的开放银行。让区块链联通万物。

[![](https://custodydocs.chainup.com/zh/latest/_images/yuanjing.jpg)](https://custodydocs.chainup.com/zh/latest/_images/yuanjing.jpg)







# 接入指引 


您需要按照以下流程进行接入ChainUp Custody - MPC 钱包

[![](https://custodydocs.chainup.com/zh/latest/_images/jieruzhiyin2.png)](https://custodydocs.chainup.com/zh/latest/_images/jieruzhiyin2.png)



## 创建账号



#### 下载MPC 钱包

方式一：手机浏览器打开链接：<https://custody.chainup.com/download>

方式二：使用手机扫码打开链接下载：



<%= image_tag "qrCode.png", style:"width: 150px" %>



#### 注册MPC 账户

打开【Custody】应用，注册账号（未注册账号登录即注册），支持邮箱与手机号两种方式

<%= image_tag "login.png", style:"width: 250px" %>



#### 完成身份认证

身份认证信息，仅支持一种身份，且认证后不支持更换

<%= image_tag "pkyc.jpg", style:"width: 250px" %> 



<%= image_tag "ekyc.jpg", style:"width: 250px" %>



完成【身份认证】、【谷歌验证】（身份认证需要平台审核，您可以联系项目经理或客服快速审核）

<%= image_tag "safe.jpg", style:"width: 250px" %>



# 开发前准备 



## 前期准备



###  开发须知



#### 开发方式

为满足客户多样性的业务需求，ChainUp Custody支持两种对接方式：SDK与API；

SDK：支持java与PHP

java SDK地址：`https://github.com/HiCoinCom/java-sdk`

PHP SDK地址：`https://github.com/HiCoinCom/php-sdk`

API：`请查看相关文档`



#### 两对公私钥作用（API方式）

**第一对公私钥：** 开发者在开通资管账号时，需提前生成一对公私钥，其中公钥（rsa_third_pub）提供给平台B，私钥自己保管，私钥为第三方应用调用钱包服务的唯一凭证，请勿透露给任何人。第三方在请求钱包服务时，通过私钥来加密请求参数，平台接受到请求时，通过提供的公钥（rsa_third_pub）来解密请求数据。

**第二对公私钥：** 开发者开通资管账号后，平台会提供钱包公钥（rsa_wallet_pub）给开发者，第三方应用在接受到钱包的响应数据或异步通知时，需要通过公钥来进行解密。



#### 为什么需要进行提现二次确认（API方式）

钱包服务接收到第三方应用请求时，为了确认该请求为第三方应用合法请求，会调用第三方提供的接口来确认。该过程在一定程度上也能避免第三方私钥丢失所造成的影响，也为钱包服务的安全性提供了一套有效屏障。



#### 域名及API密钥（API方式）

| 生产环境域名(不支持测试环境): | <https://openapi.hicoin.vip/>                     |
| :---------------------------- | ------------------------------------------------- |
|                               |                                                   |
| app_id:                       | 请创建钱包后获取                                  |
| rsa_wallet_pub:               | Custody系统公钥；请创建钱包后从Custody系统获取    |
| rsa_third_prv:                | 客户私钥；自主生成、保存                          |
| rsa_third_pub:                | 客户公钥；自主生成；请创建钱包后配置到Custody系统 |



[RSA 公私钥生成地址](http://www.metools.info/code/c80.html)

推荐密码长度：2048

推荐密钥格式：PKCS#8



说明：

1. rsa_third_prv为第三方应用私钥，主要用于加密请求参数。如果是生产环境，rsa_third_prv由开发者生成，然后将对应的公钥提供给平台。测试环境为了简化开发者对接流程，此处直接提供了一套第三方的公私钥，便于开发者快速对接。


2. 目前不支持测试环境对接，请根据**接入指引**自主注册创建钱包后，获取生产环境的API相关信息。





### 资管账号准备

开发者准备如下信息：

1）生成一对公私钥，将公钥提供给平台；

2）第三方应用服务器IP；

3）充值提现回调通知地址；

4）提现二次确认地址；

5）是否开启自动归集功能，开启后，系统会自动将用户充值资金划转到商户归集账户。



联系平台相关人员，提供上述五类信息。平台为您准备资管账号，提供到您这边包括以下信息：

1）商户的唯一标识：`app_id`；

2）钱包公钥：`rsa_wallet_pub`。







### 接口交互过程

文档为钱包服务对第三方应用提供的接口。

[![../_images/apiopen-instructions-v2.png](https://custodydocs.chainup.com/zh/latest/_images/apiopen-instructions-v2.png)](https://custodydocs.chainup.com/zh/latest/_images/apiopen-instructions-v2.png)

以下文档中的接口提供方称为 **钱包服务**，接口调用方称为 **第三方应用**。第三方应用在请求钱包服务时，通过RSA算法对请求参数进行加密，接受到钱包服务的响应数据后需要进行解密







### 接口规则

| 传输方式:     | https(测试环境暂时使用 http)                           |
| :------------ | ------------------------------------------------------ |
| 签名字段:     | 除了 `sign` 字段，其他所有必填项都需要参与签名         |
| 响应状态码为: | `0`表示处理`成功`，非 0 表示**请求错误**或**系统异常** |
| 请求地址:     | 域名+接口地址                                          |
| 加密算法:     | 详见`附 1`                                             |







## 附录 

> 请求参数加密示例

```java
// 原始请求参数
String originReqData = '{"charset":"utf-8","symbol":"eth","sign":"","time":"1586420916306","app_id":"baaceb1e506e1b5d7d1f0a3b1622583b","version":"2.0"}'
// encryptByPrivate方法封装在下列公共类RSAHelper.java中
String encryptReqData = RSAHelper.encryptByPrivate(originReqData, "第三方自己的私钥")
//http post
String httpBuildParams = "app_id=baaceb1e506e1b5d7d1f0a3b1622583b&data=" + encryptReqData
```


> 响应数据解密示例

```java
// 响应的原始数据
String originResp= '{"data":"jwtkGrhh2EVJS8xe93MpUYd-SQ-TyK0Bx5sXjE4hygFNg4wmctiahtIYXRpR2j8yDaEF5YzVstnUKbOH2p44FSMjXMQU4qFrhD00WOfW7v4LNALyiQXRb_5sakR0Zf573lGfLRTPlzLtTho3gqu3hMwuAv5e3r2dpb6_jxh1Z9BjkzSsNRX_bjLcHLUOPhMvo6rTUKSa9LQ6QnT8RX0eqzOZPlnCw3TeX_zcWWjxp6fcpKcdODxoI86gHwWRpSd-2qbEbFcaT12CJd9nPXA0KnLPNNHWz8sxQGiAg7Jg_-cN_yBHL9cS15zecTemYGqpOXRkojM1JwLsjM-7txf_dw"}'
// 解密响应数据
String encryptRespData = JSON.parse(originResp)['data']
// decryptByPublic 方法封装在下列公共类 RSAHelper.java中
String decryptRespData = RSAHelper.decryptByPublic( encryptRespData, "托管平台提供的公钥" )
```

### 附 1:加解密方式



请求参数data与响应字段data的值都是经过rsa加密后再通过 **base64urlsafe** 加密的结果



<aside class="notice">
*注意事项*
<br/>
<br/>
1）base64传统编码中会出现+, /两个会被url直接转义的符号，因此如果希望通过url传输这些编码字符串，我们需要先做传统base64编码，随后将+和/分别替换为- _两个字符，在接收端则做相反的动作解码
<br/>
<br/>
2）java Demo ： https://github.com/HiCoinCom/WaaSDemo
<br/>
<br/>
3）rsa加密与解密使用分段加密
</aside>

















### 附 2:接口错误码表 - 表格

| code    | msg                                                  |
| ------- | ---------------------------------------------------- |
| 0       | 成功                                                 |
| 100001  | 系统错误                                             |
| 100004  | 请求参数不合法(提现二次确认接口回调失败)             |
| 100005  | 签名校验失败                                         |
| 100007  | 非法IP                                               |
| 100015  | 商户ID无效                                           |
| 100016  | 商户信息过期                                         |
| 110004  | 用户被冻结不可提现                                   |
| 110023  | 手机号已注册                                         |
| 110037  | 提现地址存在风险                                     |
| 110055  | 提现地址错误                                         |
| 110065  | 请求用户用户不存在（获取用户余额、提现或转账时用到） |
| 110078  | 提现或转账金额小于最小转出金额                       |
| 110087  | 提现或转账金额大于最大转出金额                       |
| 110088  | 请勿重复提交请求                                     |
| 110089  | 注册手机号不正确                                     |
| 110101  | 用户注册失败                                         |
| 110161  | 超过提现最大支持精度                                 |
| 120202  | 币种不支持                                           |
| 120206  | 提现二次确认失败                                     |
| 120402  | 提现或转账余额不足                                   |
| 120403  | 提现手续费余额不足                                   |
| 120404  | 提现或转账金额太小, 小于等于手续费                   |
| 900006  | 用户存在风险，禁止提现                               |
| 3040006 | 不能给自己转账                                       |









# API接口

## 统一说明



#### 请求参数统一格式

| Param  | 类型   | 是否必须 | 说明                                                      |
| :----- | :----- | :------- | :-------------------------------------------------------- |
| app_id | String | 必须     | 商户唯一标识                                              |
| data   | String | 可选     | 加密之后的字符串，具体加密信息见各接口 `请求参数数据结构` |



#### 请求接口示例：

`POST /api/mpc/sub_wallet/assets`



> 请求接口示例：

```java
POST /api/mpc/sub_wallet/assets

app_id=2128eb8de9e932a4376909f3d69424cc&data=SWYYr-LBVAmaS0eq8n-CUT_nHkM3OBxyWOsImMTe41UaqAoYI2ZghmaphXHov-7hsRsVmOhyPqC-JFuRGvonJKFd2Jirxv6Vn_8V40r_MMYTkhqcviQbZWYW5xX8Ai8CIpqas9fIWVDIYA_NKBl0UCJpwGxscxLNpjq5Z8-BTyIYDsVBquM9zEQGBCfcA7szD9n2fN_loSkoexlwqV8wg9HIZO5yQ6utZ_Kt0lNDQQb8zn8BwfAvsEsbJlOINUAqhxh1vV_AJ4bXn2uYx8TaYcBht-n_ZcBdxIDt975dbOFUiH-oCzIuDi1oLDtb4EylfCvhU5E4ozel_lQ-6cyIG0Dqiiyx0RFFOCJzPSXIoV031pvoa8pTCpkWklh8mRw1rylBgeZtqSxpnJO2_u2RIlXq6Hs8Yly9CmhIXaSrUgPir0h6xVxlf4VC6PFVCkiiTlp0kZ_H_UbKm0nUis3v3U2sflWJ2C449waSrikhuxVrFAQ6PQmrFVCAE6MYXNrFXJQuam2HAIQNSGbFQjspw8b_bXyfyZMGZ3K2oBC4I_v3eETTdPe0pfSNJb-5g37K0tOAr_UFbWK8pkC8yl56fSjn8tcR3yCRWwoi8jxTcUBiswTtvXZtzgG4dyzkaHXjsZjSGiywXSqP76VZWlyOmAx6IDSViLcPLPISdU3ruCI
```





#### 响应参数统一格式

| Param | 类型   | 是否必须 | 说明                                                      |
| :---- | :----- | :------- | :-------------------------------------------------------- |
| data  | String | 必须     | 加密之后的字符串，具体加密信息见 `响应结果data解密后格式` |



> 响应结果示例：

```java
{"data": "SWYYr-LBVAmaS0eq8n-CUT_nHkM3OBxyWOsImMTe41UaqAoYI2ZghmaphXHov-7hsRsVmOhyPqC-JFuRGvonJKFd2Jirxv6Vn_8V40r_MMYTkhqcviQbZWYW5xX8Ai8CIpqas9fIWVDIYA_NKBl0UCJpwGxscxLNpjq5Z8-BTyIYDsVBquM9zEQGBCfcA7szD9n2fN_loSkoexlwqV8wg9HIZO5yQ6utZ_Kt0lNDQQb8zn8BwfAvsEsbJlOINUAqhxh1vV_AJ4bXn2uYx8TaYcBht-n_ZcBdxIDt975dbOFUiH-oCzIuDi1oLDtb4EylfCvhU5E4ozel_lQ-6cyIG0Dqiiyx0RFFOCJzPSXIoV031pvoa8pTCpkWklh8mRw1rylBgeZtqSxpnJO2_u2RIlXq6Hs8Yly9CmhIXaSrUgPir0h6xVxlf4VC6PFVCkiiTlp0kZ_H_UbKm0nUis3v3U2sflWJ2C449waSrikhuxVrFAQ6PQmrFVCAE6MYXNrFXJQuam2HAIQNSGbFQjspw8b_bXyfyZMGZ3K2oBC4I_v3eETTdPe0pfSNJb-5g37K0tOAr_UFbWK8pkC8yl56fSjn8tcR3yCRWwoi8jxTcUBiswTtvXZtzgG4dyzkaHXjsZjSGiywXSqP76VZWlyOmAx6IDSViLcPLPISdU3ruCI"}

```



#### 响应结果data解密后格式



| Param | 类型   | 是否必须 | 说明                                                   |
| :---- | :----- | :------- | :----------------------------------------------------- |
| code  | String | 是       | 状态码，例：100002                                     |
| msg   | String | 是       | 响应结果说明，例：请求参数错误                         |
| data  | String | 否       | 具体响应数据，数据结构定义见各接口  `响应参数数据结构` |





## 钱包

### 获取钱包开通的主链

获取ChainUp Custody支持的MPC主链币种和开通的MPC主链币种



#### HTTP请求

`GET /api/mpc/wallet/open_coin`



#### 请求参数数据结构 



无

> 响应结果示例：

```java
{
    "open_main_chain":[
        {
            "coin_net":"BTC",
            "symbol":"BTC",
            "symbol_alias":"BTC"
        }
    ],
    "support_main_chain":[
        {
            "coin_net":"BTC",
            "if_open_chain":true,
            "symbol":"BTC",
            "symbol_alias":"BTC"
        }
    ]
}
```

#### 响应参数数据结构

| Param              | 类型    | 是否必须 | 说明                                    |
| :----------------- | :------ | :------- | :-------------------------------------- |
| Param              | 类型    | 是否必须 | 说明                                    |
| open_main_chain    | Array   | 否       | 钱包开通的主链                          |
| > coin_net         | String  | 否       | 币种网络，例：ETH                       |
| > symbol           | String  | 是       | 币种唯一标识，提币时使用，例：USDTERC20 |
| > symbol_alias     | String  | 否       | 币种真实币名，例：USDT                  |
| support_main_chain | Array   | 否       | MPC支持的主链                           |
| > coin_net         | String  | 否       | 币种网络，例：ETH                       |
| > symbol           | String  | 是       | 币种唯一标识，提币时使用，例：USDTERC20 |
| > symbol_alias     | String  | 否       | 币种真实币名，例：USDT                  |
| > if_open_chain    | Boolean | 是       | 是否开通主链 false:未开通，true:已开通  |





### 创建子钱包（用户）

传入指定的子钱包名称，为钱包创建一个新的子钱包

#### HTTP请求

`POST /api/mpc/sub_wallet/create`



#### 请求参数数据结构 

| Param           | 类型   | 是否必须 | 说明                                                         |
| :-------------- | :----- | :------- | :----------------------------------------------------------- |
| sub_wallet_name | String | 是       | 子钱包名称，最大支持50个字符，同一钱包下子钱包不能重名，例：mpc矿池 |


> 响应结果示例：

```java
{
    "sub_wallet_id": 10234122
}
```


#### 响应参数数据结构

| Param         | 类型    | 是否必须 | 说明                   |
| :------------ | :------ | :------- | :--------------------- |
| sub_wallet_id | Integer | 是       | 子钱包id，例：10234122 |







### 获取子钱包（用户）地址

获取指定子钱包及币种下的充币地址



#### HTTP请求

`POST /api/mpc/sub_wallet/get_address`



#### 请求参数数据结构

| Param         | 类型   | 是否必须 | 说明                        |
| :------------ | :----- | :------- | :-------------------------- |
| sub_wallet_id | String | 是       | 子钱包id，例：10234122      |
| symbol        | String | 是       | 币种唯一标识，例：USDTERC20 |

> 响应结果示例：

```java
{ "address":"0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b86"
}
```

#### 响应参数数据结构

| Param   | 类型   | 是否必须 | 说明                                                         |
| :------ | :----- | :------- | :----------------------------------------------------------- |
| address | String | 是       | 充值到账地址，例：0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b86 |





### 获取子钱包（用户）资产

获取指定子钱包及币种下的账户资产

#### HTTP请求

`GET /api/mpc/sub_wallet/assets`



#### 请求参数数据结构 

| Param         | 类型   | 是否必须 | 说明                        |
| :------------ | :----- | :------- | :-------------------------- |
| symbol        | String | 是       | 币种唯一标识，例：USDTERC20 |
| sub_wallet_id | String | 是       | 子钱包id，例：10234122      |

> 响应结果示例

```java
{
    "normal_balance":"1.23",
    "deposit_address":"0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b86",
    "lock_balance":"0.77"
}
```

#### 响应参数数据结构

| Param           | 类型   | 是否必须 | 说明                                                         |
| :-------------- | :----- | :------- | :----------------------------------------------------------- |
| deposit_address | String | 是       | 充值到账地址，例：0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b86 |
| normal_balance  | String | 是       | 可用余额，例：1.23                                           |
| lock_balance    | String | 是       | 冻结余额，例：0.77                                           |







### 修改子钱包（用户）在app客户端展示状态

指定子钱包在app客户端的展示情况，不展示无法在app发起交易

#### HTTP请求

`POST /api/mpc/sub_wallet/change_show_status`



#### 请求参数数据结构 

| Param           | 类型   | 是否必须 | 说明                                                      |
| :-------------- | :----- | :------- | :-------------------------------------------------------- |
| sub_wallet_ids  | String | 是       | 多个子钱包id的字符串，英文逗号分割，例：10234122,10234123 |
| app_show_status | String | 是       | 1展示 2不展示                                             |



#### 响应参数数据结构


无





## 提币



### 提现

发起一笔提现交易

#### HTTP请求

`POST /api/mpc/billing/withdraw`



#### 请求参数数据结构 

| Param         | 类型   | 是否必须 | 说明                                                         |
| :------------ | :----- | :------- | :----------------------------------------------------------- |
| Param         | 类型   | 是否必须 | 说明                                                         |
| sub_wallet_id | String | 是       | 子钱包id，例：10234122                                       |
| symbol        | String | 是       | 币种唯一标识，例：USDTERC20                                  |
| address_to    | String | 是       | 提币到账地址，例：0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b86 |
| memo          | String | 否       | 提币到账地址memo，Memo类型提币时如有可填入，例：123321       |
| amount        | String | 是       | 提币金额，例：1.23                                           |
| request_id    | String | 是       | 提币唯一标识，例：0d766c03-8382-4005-b976-16c33f780f21       |
| remark        | String | 否       | 提币备注，例：mpc矿池                                        |
| gas_price     | String | 否       | 自定义矿工费时传入，通过<预估手续费接口>获取参考值，填入大于等于0的数值fee和gas_price二选一，其中一者为0，另一者不为0； |
| gas_limit     | String | 否       | 自定义矿工费时传入，通过<预估手续费接口>获取参考值，填入大于等于0的数值 |
| fee           | String | 否       | 自定义矿工费时传入，通过<预估手续费接口>获取参考值，填入大于等于0的数值；fee是真实的矿工费，无精度，填入时需要注意fee和gas_price二选一，其中一者为0，另一者不为0； |

> 响应结果示例

```java
{
    "withdraw_id": 12345
}
```

#### 响应参数数据结构

| Param       | 类型    | 是否必须 | 说明              |
| :---------- | :------ | :------- | :---------------- |
| withdraw_id | Integer | 是       | 提币id，例：12345 |






### 提现预估手续费

获取提现需要的预估手续费用

#### HTTP请求

`GET /api/mpc/billing/gas_estimate`

#### 请求参数数据结构 

| Param  | 类型   | 是否必须 | 说明                                                     |
| :----- | :----- | :------- | :------------------------------------------------------- |
| Param  | 类型   | 是否必须 | 说明                                                     |
| from   | String | 是       | 出币地址，例：0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b84 |
| to     | String | 是       | 到账地址，例：0xd5b688639ef10ac7fb8ad0156eb0ae025dd03b86 |
| memo   | String | 否       | 提币到账地址memo，Memo类型提币时如有可填入，例：123321   |
| symbol | String | 是       | 币种唯一标识，例：USDTERC20                              |
| amount | String | 是       | 金额，例：1.23                                           |

> 响应结果示例


```java
{
    "gas_limit":0,
    "fee_unit":"Gwei",
    "gas_price1":"0",
    "fee":"0.00159",
    "gas_price2":"0",
    "gas_price3":"0",
}
```


#### 响应参数数据结构

| Param      | 类型   | 是否必须 | 说明                           |
| :--------- | :----- | :------- | :----------------------------- |
| gas_price1 | String | 是       | 手续费推荐单价第一档，例：12.4 |
| gas_price2 | String | 是       | 手续费推荐单价第二档，例：13.4 |
| gas_price3 | String | 是       | 手续费推荐单价第三档，例：14.4 |
| gas_limit  | Long   | 是       | 手续费限制，例：21000          |
| fee_unit   | String | 是       | 手续费单位，例：Gwei           |
| fee        | String | 是       | 手续费推荐值，例：0            |








### 提现加速

提现签名完成后，由于手续费不足而长时间未上链的时候，可以重新指定更高额的手续费用加速上链

#### HTTP请求

`POST /api/mpc/billing/withdraw_pending`



#### 请求参数数据结构 

| Param       | 类型   | 是否必须 | 说明                                                         |
| :---------- | :----- | :------- | :----------------------------------------------------------- |
| withdraw_id | String | 是       | 提币id，例：12345                                            |
| gas_price   | String | 是       | 通过<预估手续费接口>获取参考值，填入大于等于0的数值fee和gas_price二选一，其中一者为0，另一者不为0； |
| gas_limit   | String | 是       | 通过<预估手续费接口>获取参考值，填入大于等于0的数值          |
| fee         | String | 是       | 通过<预估手续费接口>获取参考值，填入大于等于0的数值；fee是真实的矿工费，无精度，填入时需要注意；fee和gas_price二选一，其中一者为0，另一者不为0； |



#### 响应参数数据结构



无




### 获取提币记录

获取钱包下所有子钱包提币记录，最多返回100条



#### HTTP请求

`GET /api/mpc/billing/withdraw_list`



#### 请求参数数据结构 

| Param | 类型   | 是否必须 | 说明                                                         |
| :---- | :----- | :------- | :----------------------------------------------------------- |
| ids   | String | 是       | 多个request_id的字符串，英文逗号分割，例：0d766c03-8382-4005-b976-16c33f780f21,0db54264-7ea0-41c2-af85-4dd22b5e74d6 |


> 响应结果示例

```java
[
    {
        "symbol":"ETH",
        "amount":"0.0000111",
        "real_fee":"0",
        "wihdraw_source":2,
        "fee":"0.0002782353",
        "address_to":"0xc70d1eebb7c687ec8d56bead73f104d41e6e0bda",
        "memo": "123321",
        "created_at":1672304978000,
        "txid":"0x8e6beba81b90835fc9fcd40a2bdca33243c7c3b81ac765c240837d4810874a55",
        "confirmations":0,
        "contract_address":"",
        "sub_wallet_id":"123",
        "address_from":"0x5EDc9177997Bf6B4db559A5C184051858B3B3704",
        "fee_symbol":"ETH",
        "updated_at":1672318660000,
        "base_symbol":"",
        "id":242,
        "request_id":"57fdc296-1e14-47fa-a99d-5e86f8e51008",
        "status":1200
    }
]
```


#### 响应参数数据结构

| Param              | 类型    | 是否必须 | 说明                                                         |
| :----------------- | :------ | :------- | :----------------------------------------------------------- |
|                    | Array   |          | 获取指定提币request_id的最多100条记录                        |
| > id               | Integer | 是       | 提币id，例：12345                                            |
| > request_id       | String  | 是       | 提币唯一标识，例：0d766c03-8382-4005-b976-16c33f780f21       |
| > sub_wallet_id    | Integer | 是       | 子钱包id，例：10234122                                       |
| > symbol           | String  | 是       | 币种唯一标识，提币时使用，例：USDTERC20                      |
| > amount           | String  | 是       | 提币金额，例：1.23                                           |
| > fee_symbol       | String  | 是       | 手续费币种，例：ETH                                          |
| > fee              | String  | 是       | 手续费，例：0.00123                                          |
| > real_fee         | String  | 是       | 真实消耗的手续费，例：0.00111                                |
| > created_at       | Long    | 是       | 创建时间时间戳，例：1643349275000                            |
| > updated_at       | Long    | 是       | 修改时间时间戳，例：1643349275001                            |
| > address_from     | String  | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > address_to       | String  | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > memo             | String  | 否       | 提币到账地址memo，例：123321                                 |
| > txid             | String  | 是       | 交易hash，例：0x1f4b543f17fb429b90daa8971a8d0175a1a666adc93692182925a5ac19de0741 |
| > confirmations    | Integer | 是       | 区块确认数，例：10                                           |
| > status           | Integer | 是       | 提现状态: 1000 未审批, 1100 审批通过, 待签名，1200 支付中，2000 支付完成，2100 审批拒绝，2200 拒绝，2300 交易丢弃，2400 支付失败 |
| > withdraw_source  | Integer | 是       | 提现类型： 1.app, 2.openapi                                  |
| > base_symbol      | String  | 否       | 提币币种主链唯一标识，例：ETH                                |
| > contract_address | String  | 否       | 提币币种合约地址，例：0xdac17f958d2ee523a2206206994597c13d831ec7 |








### 同步提币记录

获取钱包下所有子钱包提币记录，最多返回100条



#### HTTP请求

`GET /api/mpc/billing/sync_withdraw_list`



#### 请求参数数据结构 

| Param  | 类型   | 是否必须 | 说明                      |
| :----- | :----- | :------- | :------------------------ |
| max_id | String | 是       | 提币记录起始id，例：12345 |

> 响应结果示例

```java
[
    {
        "symbol":"ETH",
        "amount":"0.0000111",
        "real_fee":"0",
        "wihdraw_source":2,
        "fee":"0.0002782353",
        "address_to":"0xc70d1eebb7c687ec8d56bead73f104d41e6e0bda",
        "memo": "123321",
        "created_at":1672304978000,
        "txid":"0x8e6beba81b90835fc9fcd40a2bdca33243c7c3b81ac765c240837d4810874a55",
        "confirmations":0,
        "contract_address":"",
        "sub_wallet_id":"123",
        "address_from":"0x5EDc9177997Bf6B4db559A5C184051858B3B3704",
        "fee_symbol":"ETH",
        "updated_at":1672318660000,
        "base_symbol":"",
        "id":242,
        "request_id":"57fdc296-1e14-47fa-a99d-5e86f8e51008",
        "status":1200
    }
]
```

#### 响应参数数据结构

| Param              | 类型    | 是否必须 | 说明                                                         |
| :----------------- | :------ | :------- | :----------------------------------------------------------- |
|                    | Array   |          | 获取大于指定提币id的最多100条记录                            |
| > id               | Integer | 是       | 提币id，例：12345                                            |
| > request_id       | String  | 是       | 提币唯一标识，例：0d766c03-8382-4005-b976-16c33f780f21       |
| > sub_wallet_id    | Integer | 是       | 子钱包id，例：10234122                                       |
| > symbol           | String  | 是       | 币种唯一标识，提币时使用，例：USDTERC20                      |
| > amount           | String  | 是       | 提币金额，例：1.23                                           |
| > fee_symbol       | String  | 是       | 手续费币种，例：ETH                                          |
| > fee              | String  | 是       | 手续费，例：0.00123                                          |
| > real_fee         | String  | 是       | 真实消耗的手续费，例：0.00111                                |
| > created_at       | Long    | 是       | 创建时间时间戳，例：1643349275000                            |
| > updated_at       | Long    | 是       | 修改时间时间戳，例：1643349275001                            |
| > address_from     | String  | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > address_to       | String  | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > memo             | String  | 否       | 提币到账地址memo，例：123321                                 |
| > txid             | String  | 是       | 交易hash，例：0x1f4b543f17fb429b90daa8971a8d0175a1a666adc93692182925a5ac19de0741 |
| > confirmations    | Integer | 是       | 区块确认数，例：10                                           |
| > status           | Integer | 是       | 提现状态: 1000 未审批, 1100 审批通过, 待签名，1200 支付中，2000 支付完成，2100 审批拒绝，2200 拒绝，2300 交易丢弃，2400 支付失败 |
| > withdraw_source  | Integer | 是       | 提现类型： 1.app, 2.openapi                                  |
| > base_symbol      | String  | 否       | 提币币种主链唯一标识，例：ETH                                |
| > contract_address | String  | 否       | 提币币种合约地址，例：0xdac17f958d2ee523a2206206994597c13d831ec7 |








## 充值

### 获取充币记录



获取钱包下所有子钱包充币记录，最多返回100条



#### HTTP请求

`GET /api/mpc/billing/deposit_list`



#### 请求参数数据结构 

| Param | 类型   | 是否必须 | 说明                                      |
| :---- | :----- | :------- | :---------------------------------------- |
| ids   | String | 是       | 多个id的字符串，英文逗号分割，例：123,345 |


> 响应结果示例

```java
[
    {
        "symbol":"ETH",
        "amount":"1",
        "address_to":"0x33648fACAD6CECA85cf717841Ddd87c40B12438F",
        "memo": "123321",
      "created_at":1672107533000,
        "txid":"0xfd0b04024bd1d849ba69e301733194154cb42a05c1dd32065367d8c6336af711",
        "confirmations":20,
        "contract_address":"",
        "sub_wallet_id":"123",
        "address_from":"0xc70d1eebb7c687ec8d56bead73f104d41e6e0bda",
        "updated_at":1672323030000,
        "base_symbol":"",
        "id":43,
        "status":2000
    }
]
```


#### 响应参数数据结构

| Param              | 类型    | 是否必须 | 说明                                                         |
| :----------------- | :------ | :------- | :----------------------------------------------------------- |
| Param              | 类型    | 是否必须 | 说明                                                         |
|                    | Array   |          | 获取指定id的最多100条记录                                    |
| > id               | Integer | 是       | 充币id，例：12345                                            |
| > sub_wallet_id    | Integer | 是       | 子钱包id，例：10234122                                       |
| > symbol           | String  | 是       | 币种唯一标识，例：USDTERC20                                  |
| > amount           | String  | 是       | 充币金额，例：1.23                                           |
| > created_at       | Long    | 是       | 创建时间时间戳，例：1643349275000                            |
| > updated_at       | Long    | 是       | 修改时间时间戳，例：1643349275001                            |
| > address_from     | String  | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > address_to       | String  | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > memo             | String  | 否       | 到账地址memo，例：123321                                     |
| > txid             | String  | 是       | 交易hash，例：0x1f4b543f17fb429b90daa8971a8d0175a1a666adc93692182925a5ac19de0741 |
| > confirmations    | Integer | 是       | 区块确认数，例：10                                           |
| > status           | Integer | 是       | 充值状态: 1000 未确认，1100 已确认（交易区块已确认）, 2000 已完成（上账已完成），3000 异常 |
| > base_symbol      | String  | 否       | 充币币种主链唯一标识，例：ETH                                |
| > contract_address | String  | 否       | 充币币种合约地址，例：0xdac17f958d2ee523a2206206994597c13d831ec7 |




### 同步充币记录

获取钱包下所有子钱包充币记录，最多返回100条



#### HTTP请求

`GET /api/mpc/billing/sync_deposit_list`



#### 请求参数数据结构 

| Param  | 类型   | 是否必须 | 说明                    |
| :----- | :----- | :------- | :---------------------- |
| max_id | String | 是       | 提币记录起始id，例：100 |



> 响应结果示例

```java
[
    {
        "symbol":"ETH",
        "amount":"1",
        "address_to":"0x33648fACAD6CECA85cf717841Ddd87c40B12438F",
        "memo": "123321",
      "created_at":1672107533000,
        "txid":"0xfd0b04024bd1d849ba69e301733194154cb42a05c1dd32065367d8c6336af711",
        "confirmations":20,
        "contract_address":"",
        "sub_wallet_id":"123",
        "address_from":"0xc70d1eebb7c687ec8d56bead73f104d41e6e0bda",
        "updated_at":1672323030000,
        "base_symbol":"",
        "id":43,
        "status":2000
    }
]
```


#### 响应参数数据结构


| Param              | 类型    | 是否必须 | 说明                                                         |
| :----------------- | :------ | :------- | :----------------------------------------------------------- |
| Param              | 类型    | 是否必须 | 说明                                                         |
|                    | Array   |          | 获取大于指定充币id的最多100条记录                            |
| > id               | Integer | 是       | 充币id，例：12345                                            |
| > sub_wallet_id    | Integer | 是       | 子钱包id，例：10234122                                       |
| > symbol           | String  | 是       | 币种唯一标识，例：USDTERC20                                  |
| > amount           | String  | 是       | 充币金额，例：1.23                                           |
| > created_at       | Long    | 是       | 创建时间时间戳，例：1643349275000                            |
| > updated_at       | Long    | 是       | 修改时间时间戳，例：1643349275001                            |
| > address_from     | String  | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > address_to       | String  | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| > memo             | String  | 否       | 到账地址memo，例：123321                                     |
| > txid             | String  | 是       | 交易hash，例：0x1f4b543f17fb429b90daa8971a8d0175a1a666adc93692182925a5ac19de0741 |
| > confirmations    | Integer | 是       | 区块确认数，例：10                                           |
| > status           | Integer | 是       | 充值状态: 1000 未确认，1100 已确认（交易区块已确认）, 2000 已完成（上账已完成），3000 异常 |
| > base_symbol      | String  | 否       | 充币币种主链唯一标识，例：ETH                                |
| > contract_address | String  | 否       | 充币币种合约地址，例：0xdac17f958d2ee523a2206206994597c13d831ec7 |






# 交易通知

## 统一说明



`POST /用户回调通知地址`

> 交易通知请求接口示例

```java
app_id=2128eb8de9e932a4376909f3d69424cc&data=SWYYr-LBVAmaS0eq8n-CUT_nHkM3OBxyWOsImMTe41UaqAoYI2ZghmaphXHov-7hsRsVmOhyPqC-JFuRGvonJKFd2Jirxv6Vn_8V40r_MMYTkhqcviQbZWYW5xX8Ai8CIpqas9fIWVDIYA_NKBl0UCJpwGxscxLNpjq5Z8-BTyIYDsVBquM9zEQGBCfcA7szD9n2fN_loSkoexlwqV8wg9HIZO5yQ6utZ_Kt0lNDQQb8zn8BwfAvsEsbJlOINUAqhxh1vV_AJ4bXn2uYx8TaYcBht-n_ZcBdxIDt975dbOFUiH-oCzIuDi1oLDtb4EylfCvhU5E4ozel_lQ-6cyIG0Dqiiyx0RFFOCJzPSXIoV031pvoa8pTCpkWklh8mRw1rylBgeZtqSxpnJO2_u2RIlXq6Hs8Yly9CmhIXaSrUgPir0h6xVxlf4VC6PFVCkiiTlp0kZ_H_UbKm0nUis3v3U2sflWJ2C449waSrikhuxVrFAQ6PQmrFVCAE6MYXNrFXJQuam2HAIQNSGbFQjspw8b_bXyfyZMGZ3K2oBC4I_v3eETTdPe0pfSNJb-5g37K0tOAr_UFbWK8pkC8yl56fSjn8tcR3yCRWwoi8jxTcUBiswTtvXZtzgG4dyzkaHXjsZjSGiywXSqP76VZWlyOmAx6IDSViLcPLPISdU3ruCI
```



#### 交易通知请求参数统一格式

| Param  | 类型   | 是否必须 | 说明                                                    |
| :----- | :----- | :------- | :------------------------------------------------------ |
| Param  | 类型   | 是否必须 | 说明                                                    |
| app_id | String | 必须     | 商户唯一标识                                            |
| data   | String | 必须     | 加密之后的字符串，具体加密信息见各接口 请求参数数据结构 |



#### 交易通知响应参数统一格式

返回字符串：`SUCCESS`表示成功，`FAILURE`表示失败 （注意此处返回参数无需进行加密）





## 提币通知

#### 请求参数数据结构 

| Param            | 类型   | 是否必须 | 说明                                                         |
| :--------------- | :----- | :------- | :----------------------------------------------------------- |
| charset          | String | 是       | 编码格式，无特殊情况，传参数utf-8                            |
| side             | String | 是       | 通知类型， 充值通知：deposit， 提现通知： withdraw           |
| notify_time      | String | 是       | 通知时间，例：2022-11-02 11:04:05                            |
| id               | String | 是       | 提币id，例：12345                                            |
| request_id       | String | 是       | 提币唯一标识，例：0d766c03-8382-4005-b976-16c33f780f21       |
| sub_wallet_id    | String | 是       | 子钱包id，例：10234122                                       |
| symbol           | String | 是       | 币种唯一标识，提币时使用，例：USDTERC20                      |
| amount           | String | 是       | 提币金额，例：1.23                                           |
| fee_symbol       | String | 是       | 手续费币种，例：ETH                                          |
| fee              | String | 是       | 手续费，例：0.00123                                          |
| real_fee         | String | 是       | 真实消耗的手续费，例：0.00111                                |
| created_at       | String | 是       | 创建时间时间戳，例：1643349275000                            |
| updated_at       | String | 是       | 修改时间时间戳，例：1643349275001                            |
| address_from     | String | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| address_to       | String | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| memo             | String | 否       | 到账地址memo，例：123321                                     |
| txid             | String | 是       | 交易hash，例：0x1f4b543f17fb429b90daa8971a8d0175a1a666adc93692182925a5ac19de0741 |
| confirmations    | String | 是       | 区块确认数，例：10                                           |
| status           | String | 是       | 提现状态: 1000 未审批, 1100 审批通过, 待签名，1200 支付中，2000 支付完成，2100 审批拒绝，2200 拒绝，2300 交易丢弃，2400 支付失败 |
| withdraw_source  | String | 是       | 提现类型： 1.app, 2.openapi                                  |
| base_symbol      | String | 否       | 提币币种主链唯一标识，例：ETH                                |
| contract_address | String | 否       | 提币币种合约地址，例：0xdac17f958d2ee523a2206206994597c13d831ec7 |



## 充币通知

#### 请求参数数据结构


| Param            | 类型   | 是否必须 | 说明                                                         |
| :--------------- | :----- | :------- | :----------------------------------------------------------- |
| Param            | 类型   | 是否必须 | 说明                                                         |
| charset          | String | 是       | 编码格式，无特殊情况，传参数utf-8                            |
| side             | String | 是       | 通知类型， 充值通知：deposit， 提现通知： withdraw           |
| notify_time      | String | 是       | 通知时间，例：2022-11-02 11:04:05                            |
| id               | String | 是       | 充币id，例：12345                                            |
| sub_wallet_id    | String | 是       | 子钱包id，例：10234122                                       |
| symbol           | String | 是       | 币种唯一标识，例：USDTERC20                                  |
| amount           | String | 是       | 充币金额，例：1.23                                           |
| created_at       | String | 是       | 创建时间时间戳，例：1643349275000                            |
| updated_at       | String | 是       | 修改时间时间戳，例：1643349275001                            |
| address_from     | String | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| address_to       | String | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23     |
| memo             | String | 否       | 到账地址memo，例：123321                                     |
| txid             | String | 是       | 交易hash，例：0x1f4b543f17fb429b90daa8971a8d0175a1a666adc93692182925a5ac19de0741 |
| confirmations    | String | 是       | 区块确认数，例：10                                           |
| status           | String | 是       | 充值状态: 1000 未确认，1100 已确认（交易区块已确认）, 2000 已完成（上账已完成），3000 异常 |
| base_symbol      | String | 否       | 充币币种主链唯一标识，例：ETH                                |
| contract_address | String | 否       | 充币币种合约地址，例：0xdac17f958d2ee523a2206206994597c13d831ec7 |



# Co-signer部署及说明

## co-signer配置文件



> co-signer配置文件

```java
## 主配置信息
main:
  ## co-signer的服务ip地址
  tcp: "0.0.0.0:28888"
  ## 加密后的随机数种子文件
  seed_key: "conf/seed.dat"
 
## rsa配置
rsa:
  ## 加密后的rsa私钥文件
  pri_pem: "conf/rsaPri.pem"
 
## custody系统
custody_service:
  ## app_id，创建商户后获取
  app_id: ""
  ## api域名地址，见接口文档
  domain: ""
  ## custody商户公钥文件
  rsa_pub: "conf/custodyPub.pem"
  ## 请求获取响应语言，支持zh_CN和en_US
  language: "zh_CN"
 
## 客户系统
custom_service:
  ## withdraw签名回调地址
  withdraw_callback_url: ""
```



## 二进制文件名称

- co-signer

## co-signer相关命令

- co-signer -h          获取帮助命令

![image2023-2-10_14-46-42](C:\Users\65813\Downloads\image2023-2-10_14-46-42.png)



- -v                   获取co-signer版本号
- -server               启动co-signer参数，不含该参数则为工具模式
- -conf                启动co-signer时指定配置文件
- -rsa-gen              工具模式：输入启动密码，生成加密的rsa公私钥文件（私钥加密，公钥非加密）
- -rsa-pri-import         工具模式：输入启动密码，导入现有的rsa私钥，生成加密后的rsa私钥文件（仅导入私钥）
- -recover-seed         工具模式：输入启动密码，导入现有的根私钥助记词，每个单词使用英文符号 - 分隔，生成加密后的随机数种子文件







 

## 客户需要实现提现签名回调接口（签名前回调一次，签名成功回调一次）



#### HTTP请求

`POST /自定义地址`



#### 请求参数数据结构（无需进行加密）




| Param         | 类型    | 是否必须 | 说明                                                     |
| :------------ | :------ | :------- | :------------------------------------------------------- |
| withdraw_id   | Integer | 是       | 提现id，例：12345                                        |
| request_id    | String  | 是       | 提币唯一标识，例：0d766c03-8382-4005-b976-16c33f780f21   |
| pending_round | Bool    | 是       | 加速状态，false为提币，true为提币加速                    |
| from          | String  | 是       | 出币地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23 |
| to            | String  | 是       | 到账地址，例：0xf4918d61b204bc0bb888f59dda13742ce998ad23 |
| memo          | String  | 否       | 到账地址memo，例：123321                                 |
| amount        | Decimal | 是       | 提币金额，例：1.23                                       |
| symbol        | String  | 是       | 币种唯一标识，例：USDTERC20                              |



#### 回调响应参数统一格式

返回字符串：`SUCCES`表示成功，`FAILURE`表示失败 （注意此处返回参数无需进行加密）







